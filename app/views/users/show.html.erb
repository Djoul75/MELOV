<div class="container-right-part">
  <div class="row profil-top">

  <div class="col-4">
    <div class="profile-pic">
      <% if @user.photo.key? %>
        <%= cl_image_tag @user.photo.key, crop: :thumb, gravity: :face, class: 'rounded-pp' %>
      <% else %>
        <%= image_tag("avatardefaut.jpg", size: "200x200", alt: "avatar", class: "rounded-pp")%>
      <% end %>
    </div>
  </div>

  <div class="col-8">
    <div class="user-info">
      <div class="row" data-controller="follow-btn"
                       data-follow-btn-user-id-value="<%= @user.id %>">

        <h1><%= @user.nickname %></h1>

        <%= button_tag current_user.follow?(@user) ? 'Unsubscribe' : 'Subscribe', data: { follow_btn_target: 'btn', action: 'click->follow-btn#toggle' }, class: 'yellow-button' %>

        <%#= link_to 'Subscribe', subscriptions_path(id: @user.id), method: :post,
        class: "yellow-button #{ 'd-none' if @user.follower_ids.include?(current_user.id) || @user == current_user }",
        "data-follow-btn-target" => "followBtn", "data-action" =>"click->follow-btn#displayUnfollowBtn" %>

        <%#= link_to 'Unsubscribe', subscription_path(id: @user.id), method: :delete,
        class: "yellow-button #{ 'd-none' unless @user.follower_ids.include?(current_user.id) || @user == current_user }",
        "data-follow-btn-target" => "unfollowBtn", "data-action" =>"click->follow-btn#displayFollowBtn" %>
        <div class="user-count" data-follow-btn-target="count">
          <%= @user.followers.count %> Subscribers
        </div>
        <p class="profile-count"><%= pluralize @user.followings.count, "Subscriptions" %></p>
        <p class="profile-count"><%= pluralize @user.playlists.where(user: @user.id, shaker: true).count, "Shaker" %> made</p>
      </div>
    </div>
  </div>
  <div class="row mt-5">
    <h2><%= @user.playlists.count %> Playlists:</h2>
    <% if @user.playlists.any? %>
      <div class="playlist-caroussel">
        <div class="row-playlist-carroussel">
          <% @user.playlists.each do |playlist| %>
            <div class="playlist-carroussel-cover">
              <%= link_to playlist_path(playlist) do %>
                <% if playlist.playlist_songs.count > 0 %>
                  <div class="carroussel-playlist-info">
                    <%= playlist.name  %>
                    <h6> <%= playlist.playlist_songs.count %> songs </h6>
                  </div>
                  <% if playlist.image_url %>
                    <%= image_tag(playlist.image_url) %>
                  <% end %>
                <% end %>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% else %>
      <% if !@user.follower_ids.include?(current_user.id) %>
        <br><br>
        <div class="card-bg text-center mt-5">
          <h1>You haven't imported any playlists yet</h1>
          <div class="d-flex flex-column justify-content-center align-items-center">
            <h2><%= link_to 'Import your playlists', playlists_path, class: 'yellow-button w-100' %></h2>
          </div>
        </div>
      <% else %>
        <br><br>
        <div class="card-bg text-center mt-5">
          <h1>This user has not uploaded imported <br> any playlists yet</h1>
        </div>
      <% end %>
    <% end %>

  </div>
    <div class="row mt-5">
      <h2>Publications:</h2>
  <% if @user.publications.any? %>
        <div class="container-message" data-feed-subscription-target="messages">
            <% @user.publications.order(id: :desc).each do | publication | %>
              <%= render "publications/publication", publication: publication %>
            <% end %>
        </div>
    </div>
  <% else %>
    <br><br>
    <% if !@user.follower_ids.include?(current_user.id) %>
    <div class="card-bg text-center">
      <h1>You don't have any publications yet</h1>
      <br>
      <div class="d-flex flex-column justify-content-center align-items-center">
        <h2>Make your first post or   </h2>
        <h2><%= link_to 'Follow someone', publications_path, class: 'yellow-button w-100' %></h2>
      </div>
    </div>
    <% else %>
      <div class="card-bg text-center">
        <h1>This user doesn't have any publications yet</h1>
      </div>
    <% end %>
  <% end %>
</div>
